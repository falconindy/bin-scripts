#!/bin/bash

#
# fetch the latest PKGBUILD from Arch's SVN
# requires: expac
#

shopt -s extglob

svnrepo="svn://svn.archlinux.org"

[[ -z $1 ]] && { echo "Usage: ${0##*/} targets..."; exit 1; }

for pkg; do
  # read only the first, repo is only of mild importance
  read repo _ < <(expac -S '%r' $pkg)
  [[ -z $repo ]] && { echo "error: package \`$pkg' not found"; continue; }

  case $repo in
    @(community|multilib)*) repo=community ;;
    *) repo=packages ;;
  esac

  [[ -d $pkg ]] && { echo  "error: directory \`$pkg' already exists"; continue; }

  svn export "$svnrepo/$repo/$pkg/trunk" $pkg >/dev/null &&
    echo ":: checked out $pkg" ||
    echo "error: failed to get package \`$pkg'"

done

