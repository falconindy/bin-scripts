#!/bin/bash
#
# Emulates hg's `outgoing' command
#

ORIGIN=${1:-origin}

# get remote HEAD (assumes origin as remote)
read remote_head _ < <(git ls-remote $ORIGIN HEAD 2>/dev/null)
[[ -z $remote_head ]] && exit 1

# find remote_head in local commits
n=$(sed -n "/$remote_head/=" <(git rev-list --all))

if [[ ! $n ]]; then
  echo "the remote appears to be ahead of the local"
elif (( n == 1 )); then
  echo "nothing outgoing"
else
  (( n-- ))
  echo "Outgoing commits:"
  git --no-pager log --pretty=oneline HEAD~$n..

fi

